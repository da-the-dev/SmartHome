<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Умный дом</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- My CSS -->
		<link rel="stylesheet" href="styles.css" />
		<!-- My font -->
		<link rel="stylesheet" href="fonts/pixelfont.css">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	</head>

	<body class="pixel">
		<!-- Header -->
		<div class="container-fluid header">
			<h1 class="text-center pt-2">Управление умным домом</h1>
			<h2 class="text-center pb-4" id="server-status">Статус сервера: OFFLINE</h2>
		</div>

		<!-- Main body -->
		<div class="container-fluid pt-3 gif-bg">
			<div class="row text-center">

				<!-- Blinds -->
				<div class="col-lg-3">
					<h1 class="label">Жалюзи</h1>
					<button class="btn-regular" id="blinds-toggle">
						<h1>ВКЛ</h1>/ВЫКЛ
					</button>
				</div>

				<!-- Light -->
				<div class="col-lg-3">
					<h1 class="label">Свет</h1>
					<button class="btn-regular" id="light-status">
						ВКЛ/ВЫКЛ
					</button>
				</div>

				<!-- Temperature -->
				<div class="col-lg-3">
					<h1 class="label">Температура</h1>
					<h1 class="big-status mx-auto" id="temp-status">22С</h1>
				</div>

				<!-- Conditioner -->
				<div class="col-lg-3">
					<h1 class="label">Кондиционер</h1>
					<h1 class="status mx-auto" id="cond-status">Статус: ВКЛ</h1>
					<button class="btn-inversed" id="cond-toggle">ВКЛ/ВЫКЛ</button>
				</div>
			</div>

	</body>
	<script>
		let adress = window.location.href
		let host = adress.substring(7, adress.indexOf(":3000"))
		let port = 8080

		$(document).ready(() => {
			const socket = new WebSocket(`ws://${host}:${port}`)

			// Switch lights
			$("#light-status").click(() => {
				socket.send("$light")
			})

			var lightStatus = false;

			socket.addEventListener('open', (event) => {
				$('#server-status').text("Статус сервера: ONLINE")
				console.log("[Client] Connected to WS server");
			})

			// WebSocket recieved
			socket.addEventListener('message', (event) => {
				var msg = event.data
				if (msg === "$light click on")
					$("#light-status").html("<h1>ВКЛ</h1>/ВЫКЛ")
				if (msg === "$light click off")
					$("#light-status").html("ВКЛ/<h1>ВЫКЛ</h1>")

				// if (msg.startsWith("$light sensor")) {
				// 	$("#light-status").text(`Статус:\n${msg.substring(10)}`)
				// }
			})
		})
	</script>
</html>